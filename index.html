<?php
require_once(__DIR__ . "/lib/common.php");
require_once(__DIR__ . "/lib/pager.php");
$db = connect_db();

$current_page = (!empty($_GET["page"]))? $_GET["page"] : 0;

// 全体件数取得
$sql = "SELECT count(id) as all_cnt FROM job_ads";
$res = $db->query($sql);
$all_cnt_res = $res->fetch_assoc();
$all_cnt = $all_cnt_res["all_cnt"];

// データ取得
$sql = "SELECT
          DATE_FORMAT(`update_at`, '%Y/%m/%d') AS date,
          COUNT(*) AS count
        FROM job_ads
        GROUP BY DATE_FORMAT(`update_at`, '%Y%m%d');";
$res = $db->query($sql);
$ads_list = array();
while ($row = $res->fetch_assoc()) {
  $ads_list[] = $row;
}
//ページャー情報生成
$pager_data = pager($current_page, $res->num_rows);
?>
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/pager.css">
    <link rel="stylesheet" type="text/css" href="css/adsList.css">
  </head>
  <body>
    <article>
      <header>
        <h1>HWクローリングシステム</h1>
      </header>
      <div class="main-contents">
        <div class="">
          総取得件数：<?=$all_cnt?>件
        </div>
        <table class="adsTable">
          <thead>
            <tr>
              <th>No.</th><th>日付</th><th>取得件数</th><th>ダウンロード</th><th>取得済/未</th><th>削除</th>
            </tr>
          </thead>
          <tbody>
            <?php foreach ($ads_list as $key => $value) { ?>
              <tr>
                <td><?=$key+1?></td>
                <td><?=$value["date"]?></td>
                <td><?=$value["count"]?></td>
                <td><input type="checkbox" name="chk_download" value="<?=$value["date"]?>"></td>
                <td></td>
                <td><input type="checkbox" name="chk_delete" value="<?=$value["date"]?>"></td>
              </tr>
            <?php } ?>
          </tbody>
        </table>
      </div>
      <footer>
        <?php include_once(__DIR__ . "/parts/pager.html"); ?>
      </footer>
    </article>
  </body>
</html>
